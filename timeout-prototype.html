<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Timeout Detection Prototype</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #1e1e1e;
            color: #cccccc;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            color: #569cd6;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .demo-section {
            background: #252526;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            border-left: 4px solid #007acc;
        }
        
        .kiro-terminal {
            background: #1e1e1e;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid #464647;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .terminal-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #464647;
        }
        
        .kiro-icon {
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: black;
        }
        
        .command-execution {
            background: #2d2d30;
            border-radius: 6px;
            padding: 12px;
            margin: 10px 0;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
        }
        
        .command-line {
            color: #4caf50;
            margin-bottom: 8px;
        }
        
        .command-output {
            color: #cccccc;
            white-space: pre-line;
            margin-bottom: 10px;
        }
        
        .timeout-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
        }
        
        .timeout-bar {
            background: #464647;
            height: 4px;
            border-radius: 2px;
            flex: 1;
            overflow: hidden;
        }
        
        .timeout-progress {
            height: 100%;
            transition: width 0.1s linear;
            border-radius: 2px;
        }
        
        .timeout-progress.normal {
            background: #4caf50;
        }
        
        .timeout-progress.warning {
            background: #ff9800;
        }
        
        .timeout-progress.critical {
            background: #f44336;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
            padding: 10px;
            border-radius: 6px;
            font-size: 13px;
        }
        
        .status-indicator.analyzing {
            background: #2d2d30;
            border-left: 3px solid #007acc;
        }
        
        .status-indicator.hung {
            background: #3c1e1e;
            border-left: 3px solid #f44336;
        }
        
        .status-indicator.waiting {
            background: #1e3c3c;
            border-left: 3px solid #00bcd4;
        }
        
        .status-indicator.slow {
            background: #3c3c1e;
            border-left: 3px solid #ffeb3b;
        }
        
        .status-indicator.connection {
            background: #3c1e3c;
            border-left: 3px solid #9c27b0;
        }
        
        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #464647;
            border-radius: 50%;
            border-top-color: #007acc;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .recovery-panel {
            background: #2d2d30;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid #464647;
        }
        
        .diagnostic-info {
            background: #1e1e1e;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 11px;
            border-left: 3px solid #569cd6;
            white-space: pre-line;
        }
        
        .recovery-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 8px 16px;
            border: 1px solid #464647;
            background: #3c3c3c;
            color: #cccccc;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.2s;
        }
        
        .btn:hover {
            background: #464647;
        }
        
        .btn.primary {
            background: #007acc;
            border-color: #007acc;
            color: white;
        }
        
        .btn.primary:hover {
            background: #005a9e;
        }
        
        .btn.danger {
            background: #d32f2f;
            border-color: #d32f2f;
            color: white;
        }
        
        .btn.danger:hover {
            background: #b71c1c;
        }
        
        .config-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .config-panel {
            background: #2d2d30;
            border-radius: 6px;
            padding: 15px;
        }
        
        .config-row {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 10px 0;
            padding: 8px;
            border-radius: 4px;
        }
        
        .config-row:hover {
            background: #3c3c3c;
        }
        
        .config-label {
            min-width: 120px;
            font-weight: 500;
            font-size: 13px;
        }
        
        .config-input {
            background: #1e1e1e;
            border: 1px solid #464647;
            color: #cccccc;
            padding: 6px 10px;
            border-radius: 4px;
            width: 80px;
            font-size: 12px;
        }
        
        .demo-controls {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .scenario-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .scenario-card {
            background: #2d2d30;
            border-radius: 6px;
            padding: 15px;
            border-left: 3px solid #007acc;
        }
        
        .scenario-card h3 {
            margin-top: 0;
            color: #569cd6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Smart Timeout Detection for Kiro Commands</h1>
        
        <div class="demo-section">
            <h2>Interactive Demo: Command Timeout Detection</h2>
            <p>Simulate different command scenarios to see how Kiro would intelligently handle timeouts:</p>
            
            <div class="demo-controls">
                <button class="btn" onclick="simulateHungProcess()">üî¥ Hung Process</button>
                <button class="btn" onclick="simulateWaitingInput()">‚è≥ Waiting for Input</button>
                <button class="btn" onclick="simulateSlowBuild()">üêå Slow Build</button>
                <button class="btn" onclick="simulateConnectionIssue()">üåê Connection Issue</button>
                <button class="btn" onclick="resetDemo()">üîÑ Reset</button>
            </div>
            
            <div class="kiro-terminal">
                <div class="terminal-header">
                    <div class="kiro-icon">ü§ñ</div>
                    <span>Kiro - Command Execution</span>
                </div>
                
                <div class="command-execution">
                    <div class="command-line">$ <span id="current-command">npm run build</span></div>
                    <div class="command-output" id="command-output">Building application...</div>
                    
                    <div class="timeout-indicator">
                        <span id="timeout-label">Timeout: 10m 0s remaining</span>
                        <div class="timeout-bar">
                            <div class="timeout-progress normal" id="timeout-progress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                
                <div class="status-indicator analyzing" id="status-indicator">
                    <span class="spinner"></span>
                    <span id="status-text">Analyzing command behavior...</span>
                </div>
                
                <div class="recovery-panel" id="recovery-panel" style="display: none;">
                    <h3>üîß Smart Recovery Options</h3>
                    <div id="diagnostic-info" class="diagnostic-info"></div>
                    <div class="recovery-actions" id="recovery-actions"></div>
                </div>
            </div>
        </div>
        
        <div class="demo-section">
            <h2>Configurable Timeout Settings</h2>
            
            <div class="config-section">
                <div class="config-panel">
                    <h3>Default Timeout Categories</h3>
                    <div class="config-row">
                        <span class="config-label">Build Commands:</span>
                        <input type="number" class="config-input" value="600" id="build-timeout">
                        <span>seconds</span>
                    </div>
                    <div class="config-row">
                        <span class="config-label">Test Commands:</span>
                        <input type="number" class="config-input" value="300" id="test-timeout">
                        <span>seconds</span>
                    </div>
                    <div class="config-row">
                        <span class="config-label">Quick Commands:</span>
                        <input type="number" class="config-input" value="30" id="quick-timeout">
                        <span>seconds</span>
                    </div>
                    <div class="config-row">
                        <span class="config-label">Git Operations:</span>
                        <input type="number" class="config-input" value="120" id="git-timeout">
                        <span>seconds</span>
                    </div>
                </div>
                
                <div class="config-panel">
                    <h3>Project-Specific Profiles</h3>
                    <div class="config-row">
                        <span class="config-label">Current Profile:</span>
                        <select class="config-input" style="width: 150px;">
                            <option>Default</option>
                            <option>Large Codebase</option>
                            <option>Microservices</option>
                            <option>ML/AI Project</option>
                        </select>
                    </div>
                    <div style="margin-top: 15px;">
                        <button class="btn primary">Save Settings</button>
                        <button class="btn">Reset to Defaults</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="demo-section">
            <h2>Timeout Detection Scenarios</h2>
            
            <div class="scenario-grid">
                <div class="scenario-card">
                    <h3>üî¥ Hung Process Detection</h3>
                    <p><strong>Indicators:</strong></p>
                    <ul>
                        <li>No output for extended period</li>
                        <li>Low CPU usage</li>
                        <li>Memory usage stable</li>
                    </ul>
                    <p><strong>Recovery Options:</strong></p>
                    <ul>
                        <li>Kill process (SIGTERM/SIGKILL)</li>
                        <li>Debug mode attachment</li>
                        <li>Check system logs</li>
                    </ul>
                </div>
                
                <div class="scenario-card">
                    <h3>‚è≥ Waiting for Input</h3>
                    <p><strong>Indicators:</strong></p>
                    <ul>
                        <li>Prompt text detected</li>
                        <li>Process waiting state</li>
                        <li>Interactive command patterns</li>
                    </ul>
                    <p><strong>Recovery Options:</strong></p>
                    <ul>
                        <li>Provide expected input</li>
                        <li>Cancel with Ctrl+C</li>
                        <li>Configure automation</li>
                    </ul>
                </div>
                
                <div class="scenario-card">
                    <h3>üêå Legitimate Slow Operation</h3>
                    <p><strong>Indicators:</strong></p>
                    <ul>
                        <li>Progressive output</li>
                        <li>High CPU/memory usage</li>
                        <li>Known slow command type</li>
                    </ul>
                    <p><strong>Recovery Options:</strong></p>
                    <ul>
                        <li>Continue waiting</li>
                        <li>View detailed progress</li>
                        <li>Optimize command</li>
                    </ul>
                </div>
                
                <div class="scenario-card">
                    <h3>üåê Connection Issues</h3>
                    <p><strong>Indicators:</strong></p>
                    <ul>
                        <li>Network timeout errors</li>
                        <li>Retry attempts</li>
                        <li>DNS/connectivity failures</li>
                    </ul>
                    <p><strong>Recovery Options:</strong></p>
                    <ul>
                        <li>Retry with backoff</li>
                        <li>Use different endpoint</li>
                        <li>Check network status</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let currentTimeout;
        let progressInterval;
        let startTime;
        
        function simulateHungProcess() {
            resetDemo();
            document.getElementById('current-command').textContent = 'python train_model.py';
            document.getElementById('command-output').textContent = 'Loading dataset...\nInitializing model...\nStarting training...\n[No output for 2m 15s]';
            
            setTimeout(() => {
                document.getElementById('status-indicator').className = 'status-indicator hung';
                document.getElementById('status-text').textContent = 'üî¥ Process appears hung - no output detected';
                showRecoveryOptions('hung', {
                    diagnostic: `Process Analysis:
‚Ä¢ PID: 12345
‚Ä¢ CPU Usage: 0.1% (very low)
‚Ä¢ Memory: 2.3GB (stable)
‚Ä¢ Last Output: 2m 15s ago
‚Ä¢ Network Activity: None
‚Ä¢ Likely Cause: Infinite loop or deadlock`,
                    actions: [
                        { text: 'üî™ Kill Process', class: 'danger', action: 'killProcess' },
                        { text: '‚ö†Ô∏è Send SIGTERM', class: 'btn', action: 'sigterm' },
                        { text: 'üìã Check Logs', class: 'btn', action: 'checkLogs' },
                        { text: 'üêõ Debug Mode', class: 'primary', action: 'debug' }
                    ]
                });
            }, 2000);
            
            startProgressBar(600, 'critical');
        }
        
        function simulateWaitingInput() {
            resetDemo();
            document.getElementById('current-command').textContent = 'git push origin main';
            document.getElementById('command-output').textContent = 'Username for \'https://github.com\': _';
            
            setTimeout(() => {
                document.getElementById('status-indicator').className = 'status-indicator waiting';
                document.getElementById('status-text').textContent = '‚è≥ Command waiting for user input';
                showRecoveryOptions('waiting', {
                    diagnostic: `Input Detection:
‚Ä¢ Command: git push origin main
‚Ä¢ Waiting For: Username input
‚Ä¢ Prompt Pattern: "Username for 'https://github.com'"
‚Ä¢ Suggestion: Configure Git credentials or SSH keys
‚Ä¢ Alternative: Use personal access token`,
                    actions: [
                        { text: '‚å®Ô∏è Provide Input', class: 'primary', action: 'provideInput' },
                        { text: '‚ùå Cancel (Ctrl+C)', class: 'btn', action: 'cancel' },
                        { text: 'üîë Setup SSH Keys', class: 'btn', action: 'setupSSH' },
                        { text: '‚öôÔ∏è Configure Credentials', class: 'btn', action: 'configCreds' }
                    ]
                });
            }, 1500);
            
            startProgressBar(120, 'warning');
        }
        
        function simulateSlowBuild() {
            resetDemo();
            document.getElementById('current-command').textContent = 'docker build -t myapp .';
            document.getElementById('command-output').textContent = 'Step 4/15: RUN npm install\n ---> Running in abc123def456\nnpm WARN deprecated package@1.0.0\nInstalling dependencies... (3m 45s elapsed)';
            
            setTimeout(() => {
                document.getElementById('status-indicator').className = 'status-indicator slow';
                document.getElementById('status-text').textContent = 'üêå Legitimate slow operation - Docker build in progress';
                showRecoveryOptions('slow', {
                    diagnostic: `Build Analysis:
‚Ä¢ Command: docker build
‚Ä¢ Progress: Step 4/15 (npm install)
‚Ä¢ Expected Duration: 8-12 minutes
‚Ä¢ Current Runtime: 3m 45s
‚Ä¢ CPU Usage: 85% (active)
‚Ä¢ Status: Normal for Docker builds with dependencies
‚Ä¢ Optimization: Consider using .dockerignore`,
                    actions: [
                        { text: '‚è≥ Continue Waiting', class: 'primary', action: 'continue' },
                        { text: 'üìÑ View Full Logs', class: 'btn', action: 'viewLogs' },
                        { text: 'üõë Cancel Build', class: 'danger', action: 'cancel' },
                        { text: '‚ö° Optimize Dockerfile', class: 'btn', action: 'optimize' }
                    ]
                });
            }, 2500);
            
            startProgressBar(600, 'normal');
        }
        
        function simulateConnectionIssue() {
            resetDemo();
            document.getElementById('current-command').textContent = 'npm install';
            document.getElementById('command-output').textContent = 'npm WARN registry Request timeout: https://registry.npmjs.org\nnpm WARN registry Retrying... (attempt 3/5)';
            
            setTimeout(() => {
                document.getElementById('status-indicator').className = 'status-indicator connection';
                document.getElementById('status-text').textContent = 'üåê Network connectivity issue detected';
                showRecoveryOptions('connection', {
                    diagnostic: `Network Analysis:
‚Ä¢ Command: npm install
‚Ä¢ Issue: Registry connection timeout
‚Ä¢ Registry: https://registry.npmjs.org
‚Ä¢ Retry Attempts: 3/5
‚Ä¢ Network Status: Intermittent connectivity
‚Ä¢ DNS Resolution: OK
‚Ä¢ Suggestion: Try different registry or work offline`,
                    actions: [
                        { text: 'üîÑ Retry Command', class: 'primary', action: 'retry' },
                        { text: 'üåç Use Different Registry', class: 'btn', action: 'changeRegistry' },
                        { text: 'üì± Work Offline', class: 'btn', action: 'offline' },
                        { text: 'üîç Check Network', class: 'btn', action: 'checkNetwork' }
                    ]
                });
            }, 2000);
            
            startProgressBar(300, 'warning');
        }
        
        function resetDemo() {
            clearTimeout(currentTimeout);
            clearInterval(progressInterval);
            document.getElementById('recovery-panel').style.display = 'none';
            document.getElementById('timeout-progress').style.width = '0%';
            document.getElementById('timeout-progress').className = 'timeout-progress normal';
            document.getElementById('status-indicator').className = 'status-indicator analyzing';
            document.getElementById('status-text').textContent = 'Analyzing command behavior...';
            document.getElementById('timeout-label').textContent = 'Timeout: 10m 0s remaining';
            document.getElementById('current-command').textContent = 'npm run build';
            document.getElementById('command-output').textContent = 'Building application...';
        }
        
        function startProgressBar(duration, type) {
            const progressBar = document.getElementById('timeout-progress');
            const timeoutLabel = document.getElementById('timeout-label');
            startTime = Date.now();
            let progress = 0;
            const increment = 100 / (duration * 10);
            
            progressInterval = setInterval(() => {
                progress += increment;
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                const remaining = Math.max(0, duration - elapsed);
                const minutes = Math.floor(remaining / 60);
                const seconds = remaining % 60;
                
                progressBar.style.width = Math.min(progress, 100) + '%';
                timeoutLabel.textContent = `Timeout: ${minutes}m ${seconds}s remaining`;
                
                if (progress >= 60 && type === 'normal') {
                    progressBar.className = 'timeout-progress warning';
                } else if (progress >= 85) {
                    progressBar.className = 'timeout-progress critical';
                }
                
                if (progress >= 100) {
                    clearInterval(progressInterval);
                    timeoutLabel.textContent = 'Timeout: EXPIRED';
                }
            }, 100);
        }
        
        function showRecoveryOptions(type, options) {
            const panel = document.getElementById('recovery-panel');
            const diagnostic = document.getElementById('diagnostic-info');
            const actions = document.getElementById('recovery-actions');
            
            diagnostic.textContent = options.diagnostic;
            
            actions.innerHTML = '';
            options.actions.forEach(action => {
                const btn = document.createElement('button');
                btn.className = 'btn ' + action.class;
                btn.textContent = action.text;
                btn.onclick = () => executeRecoveryAction(action.action, action.text);
                actions.appendChild(btn);
            });
            
            panel.style.display = 'block';
        }
        
        function executeRecoveryAction(action, text) {
            alert(`Executing: ${text}\n\nThis would ${action} the command and provide appropriate feedback to the user.`);
            if (action === 'continue') {
                document.getElementById('recovery-panel').style.display = 'none';
            } else {
                resetDemo();
            }
        }
    </script>
</body>
</html>